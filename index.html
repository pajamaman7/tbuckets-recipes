<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex">
    <title>Recipes</title>

    <script src="libs/markdown-it.min.js"></script>
    <link rel="stylesheet" href="libs/modern-normalize.min.css">
    <link rel="stylesheet" href="libs/water.light.min.css">

    <style>

:root{
  --bg: #282828;
  --bg-alt: #3c3836;
  --card-bg: #3c2f2f; /* subtle card alt */
  --fg: #ebdbb2;
  --fg-dim: #bdae93;
  --accent-blue: #83a598;
  --accent-aqua: #8ec07c;
  --accent-orange: #fe8019;
  --accent-yellow: #fabd2f;
  --accent-green: #b8bb26;
  --accent-red: #fb4934;
  --muted-border: rgba(255,255,255,0.04);
}

/* sensible reset for sizing (fixes many broken div-size issues) */
* { box-sizing: border-box; }
html,body { height: 100%; margin: 0; padding: 0; background: var(--bg); color: var(--fg); font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; line-height:1.45; }

/* Make container visible again (you previously had display:none) */
.container {
  display: block;
  max-width: 1100px;
  margin: 0 auto;
  padding: 16px;
}

/* Top site header (logo + nav) */
.site-header {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  border: 1px solid var(--muted-border);
  border-radius: 10px;
  padding: 12px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 16px;
}

/* logo/title area */
.logo {
  display:flex;
  flex-direction: column;
  gap: 2px;
}
.logo h1, #title {
  margin: 0;
  color: var(--accent-yellow);
  font-size: 1.25rem;
  letter-spacing: 0.2px;
}
.logo .subtitle, #subheader {
  margin: 0;
  color: var(--fg-dim);
  font-size: 0.9rem;
  font-style: italic;
  margin-top: -2px;
}

/* simple nav */
.site-nav {
  display:flex;
  gap: 10px;
  align-items:center;
  flex-wrap:wrap;
}
.site-nav a {
  color: var(--accent-blue);
  text-decoration: none;
  padding: 6px 10px;
  border-radius: 6px;
  font-weight: 600;
  transition: all .12s ease;
  border: 1px solid transparent;
  background: transparent;
}
.site-nav a:hover { color: var(--accent-aqua); background: rgba(255,255,255,0.02); border-color: rgba(255,255,255,0.02); }
.site-nav a:focus { outline: 2px solid var(--accent-yellow); outline-offset: 3px; }

/* default link styling for content */
a {
  color: var(--accent-blue);
  text-decoration: none;
  border-bottom: 1px dashed transparent;
  transition: color .12s ease, border-color .12s ease;
}
a:hover { color: var(--accent-aqua); text-decoration: underline; border-bottom-color: rgba(255,255,255,0.04); }
a:visited { color: var(--fg-dim); }
a:focus-visible { outline: 2px solid var(--accent-yellow); outline-offset: 2px; }

/* Grid layout to replace floats ‚Äî recommended */
.content-grid {
  display: grid;
  grid-template-columns: 1fr minmax(280px, 360px);
  gap: 16px;
  align-items: start;
}

/* Main column (left) */
.main-column {
  min-width: 0; /* important for overflowing text in flex/grid children */
}

/* Sidebar column (right) ‚Äî holds info and ingredients in order) */
.sidebar {
  display: flex;
  flex-direction: column;
  gap: 16px;
  min-width: 0;
}

/* Card-like containers */
#info-container,
#ingredients-container,
#steps-container,
#notes-container,
#based-on-container {
  background-color: var(--bg-alt);
  padding: 12px 20px;
  border-radius: 8px;
  border-left: 4px solid transparent;
  overflow: visible;
}

/* individual accents */
#info-container { border-left-color: var(--accent-blue); }
#ingredients-container { border-left-color: var(--accent-green); background-color: var(--card-bg); }
#notes-container { border-left-color: var(--accent-orange); background-color: #504945; }
#based-on-container { background-color: var(--card-bg); color: var(--fg-dim); }

/* headings / icons */
#info-container h2::before { content: "‚è±Ô∏è "; }
#ingredients-container h2::before { content: "üìã "; }
#steps-container h2::before { content: "üî™ "; }
#notes-container h2::before { content: "üí° "; }
#based-on-container h2::before { content: "üîó "; }

h2 {
  margin-top: 0;
  margin-bottom: 8px;
  color: var(--accent-orange);
  font-size: 1.05rem;
}

/* small screens: stack everything */
@media (max-width: 900px) {
  .content-grid { grid-template-columns: 1fr; }
  .site-header { flex-direction: column; align-items: stretch; gap: 8px; }
  .site-nav { justify-self: end; }
}

/* print rules (keep original intent) */
@media print {
  #back-link { display:none; }
}

/* ===== Compatibility: quick float-fix if you kept the old float HTML =====
   If your HTML still uses floated #info-container / #ingredients-container,
   add this clearfix to the parent to restore proper parent height.
*/
.clearfix::after {
  content: "";
  display: table;
  clear: both;
}

/* Also ensure any floated elements are overridden by the new layout */
#info-container[style*="float"], #ingredients-container[style*="float"] {
  float: none !important;
}
    </style>

    <script>
        const md = window.markdownit();

        async function loadRecipe() {
            const urlParams = new URLSearchParams(window.location.search);
            const recipeFile = urlParams.get('recipe');

            if (!recipeFile) {
                return;
            }

            const result = await fetch(`recipes/${recipeFile}.md`);
            return result.text();
        }

        async function loadRecipeList() {
            const result = await fetch(`recipes.md`);
            return result.text();
        }

        async function parseMarkdown(markdown) {
            // Extract title (# TITLE)
            const titleMatch = markdown.match(/^# (.+)/m);
            const title = titleMatch ? titleMatch[1] : '';

            // Extract optional subheader (line after title, before ##)
            const subheaderMatch = markdown.match(/^# .+\n(.+?)\n##/m);
            const subheader = subheaderMatch ? subheaderMatch[1] : '';

            // Extract each section by heading
            const infoMatch = markdown.match(/## info\s+([\s\S]+?)(?=\n## |$)/);
            const info = infoMatch ? infoMatch[0] : '';

            const ingredientsMatch = markdown.match(/## ingredients\s+([\s\S]+?)(?=\n## |$)/);
            const ingredients = ingredientsMatch ? ingredientsMatch[0] : '';

            const stepsMatch = markdown.match(/## steps\s+([\s\S]+?)(?=\n## |$)/);
            const steps = stepsMatch ? stepsMatch[0] : '';

            const notesMatch = markdown.match(/## notes\s+([\s\S]+?)(?=\n## |$)/);
            const notes = notesMatch ? notesMatch[0] : '';

            const basedOnMatch = markdown.match(/## based on\s+([\s\S]+?)$/);
            const basedOn = basedOnMatch ? basedOnMatch[0] : '';

            return [title, subheader, info, ingredients, steps, notes, basedOn];
        }

        async function init() {
            const recipe = await loadRecipe();

            if (!recipe) {
                const recipeList = await loadRecipeList();
                document.getElementById("recipe-list").innerHTML
                    = md.render(recipeList);
                document.getElementById("recipe-list").style.display = "block";
                return;
            }

            const [title, subheader, info, ingredients, steps, notes, basedOn] = await parseMarkdown(recipe);
            
            document.title = title;

            document.getElementById("title").innerHTML = title;
            
            if (subheader) {
                document.getElementById("subheader").innerHTML = subheader;
                document.getElementById("subheader").style.display = "block";
            }

            if (info) {
                document.getElementById("info-container").innerHTML = md.render(info);
            }

            if (ingredients) {
                document.getElementById("ingredients-container").innerHTML = md.render(ingredients);
            }

            if (steps) {
                document.getElementById("steps-container").innerHTML = md.render(steps);
            }

            if (notes) {
                document.getElementById("notes-container").innerHTML = md.render(notes);
            }

            if (basedOn) {
                document.getElementById("based-on-container").innerHTML = md.render(basedOn);
            }

            document.getElementById("recipe-container").style.display = "block";
        }

        init().catch(error => console.log(error));
    </script>
</head>

<body>
    <div id="recipe-container" class="container">
        <div id="title-wrapper">
            <a id="back-link" href="/tbuckets-recipes">
                <svg xmlns="http://www.w3.org/2000/svg" id="back-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </a>
            <h1 id="title"></h1>
        </div>
        <div id="subheader" style="display: none;"></div>
        <div id="info-container"></div>
        <div id="ingredients-container"></div>
        <div id="steps-container"></div>
        <div id="notes-container"></div>
        <div id="based-on-container"></div>
    </div>
    <div id="recipe-list" class="container"></div>
</body>

</html>
